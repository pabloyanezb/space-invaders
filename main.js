var world =[
    ['X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','X'],
    ['X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X','X'],
    ];
var score = 0;
var nave = {
    x:18,
    y:23
}
// var disparo = [];

function displayWorld(){
    var output = '';
    for (var i=0; i<world.length; i++){
        output += "\n<div class='row'>"
        for (var j=0; j<world[i].length; j++){
            if(world[i][j] == 'X'){
                output += "\n\t<div class='brick'></div>";
            }
            if(world[i][j] == '0'){
                output += "\n\t<div class='empty'></div>";
            }
            if(world[i][j] == '1'){
                output += "\n\t<div class='invader'></div>";
            }
        }
            output += "\n</div>";
    }
    // console.log(output);
    document.getElementById('world').innerHTML = output;
}
function disparar(){
    var disparar = document.createElement('audio');
    disparar.setAttribute('src', 'sonido/shoot.wav');
    disparar.play();
};
function explosion(){
    var explosion = document.createElement('audio');
    explosion.setAttribute('src', 'sonido/explosion.wav');
    explosion.play();
};
      

function displayNave(){
    document.getElementById('nave').style.top = nave.y*20+"px"
    document.getElementById('nave').style.left = nave.x*20+"px"
}
function displayScore(){
    document.getElementById('score').innerHTML = score;
}

displayWorld();
displayNave();
displayScore();

document.onkeydown = function(e){
    if(e.keyCode == 37 && world[nave.y][nave.x-1] != 'X'){
       nave.x -= 1;
    }
    else if(e.keyCode == 39 && world[nave.y][nave.x+1] != 'X'){
       nave.x += 1;
    }
    else if(e.keyCode == 32){
       crearDisparo();
    }

    
    
    displayNave();
}

function crearDisparo(){
    var world = document.getElementById('world');
    var misil = document.createElement("div");
    misil.className = "misil";
    world.appendChild(misil);
   
    //Posiciona al misil sobre la nave (su misma posición x al momento de disparar)
    misilX = (nave.x*20)-370;
    misil.style.transform = `translate(${misilX}px)`;
    //Mueve los misiles hacia arriba
    setInterval(function(){
        var misilY = misil.offsetTop;
        misil.style.top = (misilY - 5 ) + 'px';
        detectarColision(misil,misilY,misilX);
    //Elimina los misiles que salen de la pantalla (cuando su posición top es menor a cero)
    
        if ( misilY < 0 ){
            world.removeChild(misil);
            };
        }, 10);
        disparar();
}
function detectarColision(misil,misilY,misilX){
    if(misilY/20 < 0 ){
        return;
    }
    var posicion = world[Math.floor(misilY/20)][Math.floor((misilX/20)+19)] 
    if( posicion == '1'){
        world[Math.floor(misilY/20)][Math.floor((misilX/20)+19)] = '0';
        explosion();
        // world.removeChild(misil);
        score = score + 10;
        displayWorld();
        displayScore(); 
    }        
        
}


        
           
